<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="sku_dlg" class="easyui-dialog" title="编辑sku" style="width:700px;height:520px;" closed="true" data-options="iconCls:'icon-save',resizable:true,modal:false" buttons="#skuBtns">
    <form id="skuForm">
        <br/>
        <label>sku名称:</label>
        <input id="skuName" name="skuName" class="easyui-textbox" data-options="" style="width:300px;"/>
        <br/><br/>
        <label>商品价格:</label>
        <input id="price" name="price" class="easyui-numberbox" data-options="min:0,precision:2" style="width:300px;"/>
        <br/><br/>
        <label>商品重量（千克):</label>
        <input id="weight" name="weight" class="easyui-numberbox" data-options="min:0,precision:2" style="width:300px;"/>
        <br/><br/>
        <label>商品规格描述:</label>
        <input id="skuDesc" name="skuDesc" class="easyui-textbox" data-options="multiline:true" style="width:500px;height:100px"/>
        <input id="spuIdForSku" name="spuId" type="hidden"/>

        <input id="skuId" name="id" type="hidden"/>

        <input id="catalog3IdForSku" name="catalog3Id" type="hidden"/>
        <br/><br/>

        <input id="skuInfo" name="skuInfo" type="hidden"/>


        <div id="attrInfoGroup" title="平台属性" class="easyui-panel" style="padding:5px;">

        </div>

        <div id="spuSaleAttrGroup" title="销售属性" class="easyui-panel" style="padding:5px;"></div>


        <!----------------商品图片列表 ----------------------->

        <table id="skuImgDg" class="easyui-datagrid" title="商品图片列表"
               data-options="singleSelect:false,selectOnCheck:false,method:'get'"></table>

        <br/><br/>


        <!-------------->


    </form>
</div>
<!----------------弹出框的按钮组----------------------->
<div id="skuBtns">
    <a href="#" class="easyui-linkbutton" onclick="saveSku()">保 存</a>
    <a href="#" class="easyui-linkbutton" onclick="closeSku()">关 闭</a>
</div>

<script language="application/javascript">

    function closeSku() {
        $("#skuForm").dialog("close");
    }

    function initSkuInfoDlg(spuInfo) {
        // 获取 三级分类 id
        catalog3Id = $("#ctg3ForSpuList").combobox("getValue");
        // 初始化sku表单
        $("#spuIdForSku").val(spuInfo.id);
        // 初始化平台属性
        initAttrInfoGroup(catalog3Id);
        // 初始化销售属性
        initSpuSaleAttrGroup(spuId);
        // 初始化图片列表
        initSkuImgListDatagrid(spuId);
    }

    function initAttrInfoGroup(catalog3Id) {

        $.post("attrInfoList/"+catalog3Id, null, function (data) {

            var append = "";
            $(data).each(function (i, attr) {

                spanHead = "<span attrId = '" + attr.id + "'>";
                attrName = attr.attrName;
                var attrValueList = attr.attrValueList;

                selectHead = "<select>";
                options = "";
                $(attrValueList).each(function (j, attrValue) {
                    options = options + "<option value='" + attrValue.id + "'>" + attrValue.valueName + "</option>";
                });
                selectEnd = "</select>";
                spanEnd = "</span>";

                append = append + spanHead + attrName + selectHead + options + selectEnd + spanEnd;
            });

            $("#attrInfoGroup").empty();
            $("#attrInfoGroup").append($(append));
        });
    }

    function initSpuSaleAttrGroup(spuId) {
        alert("初始化销售属性");
    }

    function initSkuImgListDatagrid(spuId) {
        alert("初始化图片列表");
    }

    function saveSku() {

        var skuInfo = {};

        // 获取平台属性列表
        var spans = $("#attrInfoGroup").children("span");
        $(spans).each(function (i, span) {
            var attrId = $(span).attr("attrId");
            var valueId = $(span).children("select").val();

            skuInfo["skuAttrValueList[" + i + "].attrId"] = attrId;
            skuInfo["skuAttrValueList[" + i + "].valueId"] = valueId;
        });

        $.post("saveSku", skuInfo, function (data) {
            alert(data);
        });

        //关闭对话框
        $("#sku_dlg").dialog("close");
    }

</script>
</body>
</html>